<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ear Trainer v1.0</title>
  <link rel="stylesheet" href="style.css" />
  <script src="tone.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Ear Trainer v1.0</h1>

  <div id="controls">
    <button id="initBtn">Start Audio</button>
    <button id="testPiano" onclick="testPiano()" style="background: #e6f3ff;">Test Piano</button>
    <button id="replayC">Replay C</button>
    <button id="replayTest">Replay Test</button>
    <button id="newNote">New Note</button>
    <button id="skipNote">Skip Note</button>
    <button id="showTable">Show Stats Table</button>
    <button id="downloadStats" onclick="downloadStatsLog()">Download Stats</button>
    <button id="resetStats" onclick="resetAllStats()" style="background: #ffcccc;">Reset Stats</button>
  </div>

  <div id="stats">
    <h3>Your Progress</h3>
    <div class="stat-item">Correct First Try: <span id="correctFirst">0</span></div>
    <div class="stat-item">Wrong/Skipped: <span id="wrongSkipped">0</span></div>
    <div class="stat-item">Accuracy: <span id="accuracy">0%</span></div>
    <div class="stat-item">Total Notes: <span id="totalNotes">0</span></div>
    <div class="stat-item streak">Current Streak: <span id="currentStreak">0</span></div>
    <div class="stat-item streak">Best Streak: <span id="bestStreak">0</span></div>
    <div style="margin-top: 10px; font-size: 12px; color: #666;">
      Shortcuts: Space=Play/New, S=Skip, D=Download Stats
      <br>Stats persist across browser sessions - use Reset button to clear
    </div>
  </div>

  <div id="keyboard"></div>

  <div id="log"></div>

  <!-- Modal for detailed stats -->
  <div id="statsModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>📊 Detailed Note Statistics</h2>
      
      <!-- Sorting controls -->
      <div class="sort-controls">
        <span>Sort by:</span>
        <button onclick="sortStatsTable('accuracy')" class="sort-btn">🎯 Best Accuracy</button>
        <button onclick="sortStatsTable('timesHeard')" class="sort-btn">🎵 Most Played</button>
        <button onclick="sortStatsTable('worst')" class="sort-btn">⚠️ Needs Practice</button>
        <button onclick="sortStatsTable('note')" class="sort-btn">🎹 Note Order</button>
        <button onclick="toggleStatsView()" class="sort-btn" id="viewToggle">📊 Show Charts</button>
      </div>
      
      <!-- Table View -->
      <div id="tableView">
        <table id="statsTable">
          <thead>
            <tr>
              <th>Note</th>
              <th>Times Heard</th>
              <th>Correct First Try</th>
              <th>Missed/Skipped</th>
              <th>Accuracy</th>
            </tr>
          </thead>
          <tbody id="statsTableBody">
          </tbody>
        </table>
      </div>
      
      <!-- Chart View -->
      <div id="chartView" style="display: none;">
        <div class="chart-controls">
          <button onclick="showChart('accuracy')" class="chart-btn">📈 Accuracy Chart</button>
          <button onclick="showChart('performance')" class="chart-btn">📊 Performance Chart</button>
          <button onclick="showChart('radar')" class="chart-btn">🎯 Radar Chart</button>
        </div>
        <div class="chart-container">
          <canvas id="statsChart" width="400" height="200"></canvas>
        </div>
      </div>
      
      <!-- Legend -->
      <div class="stats-legend">
        <h4>Legend:</h4>
        <div class="legend-item">🥇 Best performing note</div>
        <div class="legend-item">🔥 Perfect streak (100% accuracy, 3+ attempts)</div>
        <div class="legend-item">✅ Correct answers | ❌ Wrong answers</div>
        <div class="legend-item">🎵 Played notes | ⚪ Unplayed notes</div>
        <div class="legend-item">
          <span class="color-sample" style="background: #4CAF50;"></span> 80%+ accuracy
          <span class="color-sample" style="background: #FFC107;"></span> 60-79% accuracy
          <span class="color-sample" style="background: #FF9800;"></span> 40-59% accuracy
          <span class="color-sample" style="background: #F44336;"></span> &lt;40% accuracy
        </div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
